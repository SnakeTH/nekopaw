*preinstalled=0

[main]
$main.url = 'http://derpiboo.ru/';
$main.icon = 'derpiboo.ru.bmp';
$picture.fields(url,preview,post_url,width:i,height:i,aspect_ratio:f);
$main.short = 'poni';

$main.checkcookie = '_booru-on-rails_session';
$userstring = 'user[email]';
$pwdstring = 'user[password]';
$main.login = '$main.url+"users/sign_in?"+$userstring+"="+$login+"&"+$pwdstring+"="+$password+"&user[remember_me]=1&commit=Sign in"';


$gui_thumbs_dir = '/BAhbB1sHOgZmSSI';
$gui_images_dir = '/BAhbBlsHOgZmSSI';
$picsperpage = 15;

[listscript]
$thread.url = "$main.url+'images/search/'+@httpencode($tag)+'/1'";
$thread.xml = 'fpgui';
thread.execute();
$thread.xml = 'listgui';
$thread.url = "$main.url+'images/search/'+@httpencode($tag)+'/'+$thread.counter+1";

[dwscript]
$thread.url = $picture%url;
$thread.referer = $picture%post_url;

[fpgui]
^div#class='image'{
	^a#title{
		$post_url = @removevars(#href);
		$alt = #alt;
		^img{
			?@emptyname(#src)!'questionable.png'{
				addpicture(
					%url=@replace($gui_images_dir,$gui_thumbs_dir,#src),
					%preview=#src,
					%post_url=$main.url+@trim($post_url,"/"),
					%width=@isempty(@trim(@copyto("x",@copyfromtoex(" |","Size: ",$alt))),1),
					%height=@isempty(@trim(@copyfrom("x",@copyfromtoex(" |","Size: ",$alt))),1),
					%aspect_ratio=$picture%width/$picture%height,
					%tags=csv(@trim(@copyfrom("| Tagged: ",@replace(",",", ",$alt))),",")
				);
				$picture.filename = @emptyname($picture%url);
			}
		}
	}
}
^nav#class='pagination'{
	^a{
		?$thread.count < @isempty(@emptyname(#href),1){
			$thread.count=@isempty(@emptyname(#href),1);
			$thread.result=$thread.count*$picsperpage;
		}
	}
}

[listgui]
^div#class='image'{
	^a#title{
		$post_url = @removevars(#href);
		$alt = #alt;
		^img{
			?@emptyname(#src)!'questionable.png'{
				addpicture(
					%url=@replace($gui_images_dir,$gui_thumbs_dir,#src),
					%preview=#src,
					%post_url=$main.url+@trim($post_url,"/"),
					%width=@isempty(@trim(@copyto("x",@copyfromtoex(" |","Size: ",$alt))),1),
					%height=@isempty(@trim(@copyfrom("x",@copyfromtoex(" |","Size: ",$alt))),1),
					%aspect_ratio=$picture%width/$picture%height,
					%tags=csv(@trim(@copyfrom("| Tagged: ",@replace(",",", ",$alt))),",")
				);
				$picture.filename = @emptyname($picture%url);
			}
		}
	}
}