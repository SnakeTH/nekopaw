*preinstalled=0

[main]
$main.url='http://rmart.org/';
$main.icon='rmart.org.bmp';
$main.short = 'rmar';

@addfield("rating","Rating","SFW","listbox","SFW","R15","R18","R18G");
@addfield("showunrated","Show unrated",0,"checkbox");

$picture.fields(url,preview,post_url,rating,score:i,width:i,height:i,aspect_ratio:f);

$main.checkcookie = '.ASPXAUTH';
$userstring = 'LoginOrEmail';
$pwdstring = 'Password';
$main.login = '$main.url+"Account/LogIn?"+$userstring+"="+$login+"&"+$pwdstring+"="+$password+"&Remember=false&ReturnUrl=/"';

$gui_thumbs_part = 'Thumb/';
$gui_images_part = 'Src/';
$picsperpage = 30;

[listscript]
@createcookie("MaxRating",$rating);
@createcookie("ShowUnrated",@BoolStr($showunrated));
$thread.url = "$main.url+'?q='+@httpencode($tag)";
$thread.xml = 'fpgui';
thread.execute();
$thread.xml = 'listgui';
$thread.url = "$main.url+'?q='+@httpencode($tag)+'&p='+$thread.counter+1";

[dwscript]
$thread.url = $picture%url;
$thread.referer = $picture%post_url;

[fpgui]
^ul#id='thumbs'{
	^a#class='thumbnail'{
		$post_url = @removevars(#href);
		$img_ext = @copyto(",",#title);
		$width=@isempty(@trim(@copyto("x",@copyfromtoex("@",",",#title))),0);
		$height=@isempty(@trim(@copyfrom("x",@copyfromtoex("@",",",#title))),0);
		$rating=@trim(@copyfromtoex("Score:","Rating:",#title));
		$score=@isempty(@copyto(" ",@trim(@copyfromtoex("Tags:","Score:",#title))),0);
		^img{
			addpicture(
				%url=$main.url+@trim(@changeext($img_ext,@replace($gui_images_part,$gui_thumbs_part,#src)),"/"),
				%preview=$main.url+@trim(#src,"/"),
				%post_url=$main.url+@trim($post_url,"/"),
				%rating=$rating,
				%score=$score,
				%width=$width,
				%height=$height,
				%aspect_ratio=$picture%width/$picture%height,
				%tags=csv(@replace(",",", ",@trim(#alt)),",")
			);
			$picture.filename = @changeext($img_ext,@trim($post_url,"/"));
		}
	}
}
^div#class='pagination'{
	^a{
		?$thread.count < @isempty(@urlvar("p",#href),1){
			$thread.count=@isempty(@urlvar("p",#href),1);
			$thread.result=$thread.count*$picsperpage;
		}
	}
}

[listgui]
^ul#id='thumbs'{
	^a#class='thumbnail'{
		$post_url = @removevars(#href);
		$img_ext = @copyto(",",#title);
		$width=@isempty(@trim(@copyto("x",@copyfromtoex("@",",",#title))),0);
		$height=@isempty(@trim(@copyfrom("x",@copyfromtoex("@",",",#title))),0);
		$rating=@trim(@copyfromtoex("Score:","Rating:",#title));
		$score=@isempty(@copyto(" ",@trim(@copyfromtoex("Tags:","Score:",#title))),0);
		^img{
			addpicture(
				%url=$main.url+@trim(@changeext($img_ext,@replace($gui_images_part,$gui_thumbs_part,#src)),"/"),
				%preview=$main.url+@trim(#src,"/"),
				%post_url=$main.url+@trim($post_url,"/"),
				%rating=$rating,
				%score=$score,
				%width=$width,
				%height=$height,
				%aspect_ratio=$picture%width/$picture%height,
				%tags=csv(@replace(",",", ",@trim(#alt)),",")
			);
			$picture.filename = @changeext($img_ext,@trim($post_url,"/"));
		}
	}
}