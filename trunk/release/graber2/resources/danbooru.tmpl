*preinstalled=0

;template of danbooru engine

[main]
$picture.fields(
	url:s:$$URL,
	preview:s:$$PREVIEW,
	sample_url:s:$$SAMPLE,
	post_url:s:$$POSTURL,
	width:i:$$WIDTH,
	height:i:$$HEIGHT,
	rating:s:$$RATING,
	id:i:$$ID,
	author:s:$$AUTHOR,
	score:i:$$SCORE,
	posted:d:$$POSTED,
	post_date:d:$$POSTDATE,
	md5:s:$$MD5,
	source:s:$$SOURCE,
	aspect_ratio:f:$$ASPECTRATIO);
$pictime = '@vartime("en-US",#created_at,"ddd mmm dd hh:nn:ss xxxxx yyyy")'; 
$previewurl = '#preview_url';
$picurl = '$picture%url';
$fpxml = 'xml';
$lxml = 'xml';
$fcounter = 1;
$userstring = 'user[name]';
$pwdstring = 'user[password]';
$main.checkcookie = 'login';
$main.login = '$main.url+"user/authenticate?"+$userstring+"="+$login+"&"+$pwdstring+"="+$password+"&commit=Login"';
$page = '@min(1000,#count/100+1)';

[listscript]
$thread.url = "$main.url+'post/index.'+$fpxml+'?limit=100&tags='+@httpencode($tag)";
$thread.jsonitem = 'post';
$thread.xml = 'firstpagexml';
$thread.xmlcontent = $fpxml;
$thread.execute();
$thread.counter = $fcounter;
$thread.xml = 'listxml';
$thread.xmlcontent = $lxml;
$thread.url = "$main.url+'post/index.'+$lxml+'?limit=100&tags='+@httpencode($tag)+'&page='+$thread.counter+1";

[dwscript]
$thread.url = @calc($picurl);
$thread.referer = $picture%post_url;

[firstpagexml]
^posts{
	$thread.count=@calc($page);
	$thread.result=#count;
	^post{
		addpicture(
			%url=#file_url,
			%preview=@calc($previewurl),
			%sample_url=#sample_url,
			%post_url=$main.url+'post/show/'+#id,
			%width=#width,
			%height=#height,
			%rating=#rating,
			%id=#id,
			%author=#author,
			%score=#score,
			%posted=@calc($pictime),
			%post_date=@datepart(@calc($pictime)),
			%md5=#md5,
			%source=#source,
			%aspect_ratio=#width/#height,
			%tags=csv(#tags," ")
		);
		$picture.filename = @emptyname(#file_url);
	}
}

[listxml]
^post{
	addpicture(
		%url=#file_url,
		%preview=@calc($previewurl),
		%sample_url=#sample_url,
		%post_url=$main.url+'post/show/'+#id,
		%width=#width,
		%height=#height,
		%rating=#rating,
		%id=#id,
		%author=#author,
		%score=#score,
		%posted=@calc($pictime),
		%post_date=@datepart(@calc($pictime)),
		%md5=#md5,
		%source=#source,
		%aspect_ratio=#width/#height,
		%tags=csv(#tags," ")
	);
	$picture.filename = @emptyname(#file_url);
}