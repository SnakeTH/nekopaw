*preinstalled=0

[main]
$main.url='http://browse.minitokyo.net/';
$main.icon='minitokyo.net.bmp';
$picture.fields(url,preview,post_url,title,width:i,height:i,score:i,aspect_ratio:f,category,type);
$main.short = 'mini';
@addfield("wallpapers","Wallpapers",1,"checkbox");
@addfield("indyart","Indy Art",1,"checkbox");
@addfield("scans","Scans",1,"checkbox");
@addfield("allsizes","All sizes",1,"checkbox");

$main.checkcookie = 'minitokyo_hash';
$userstring = 'username';
$pwdstring = 'password';
$main.login = '$main.url+"login?"+$userstring+"="+$login+"&"+$pwdstring+"="+$password+"&login=Login"';

$gui_thumbs_part = 'thumbs/';
$gui_images_part = 'downloads/';
$picsperpage = 24;

[listscript]
$thread.url = "$main.url+'?q='+@httpencode(@replace('%2C',' ',$tag))";
$thread.xml = 'fpgui';

thread.execute();
$thread.xml = 'listgui';
$thread.url = "$main.url+'galley?tid='+$id+'&index='+@queueindex($thread.counter,$wp,$ia,$sc)+'&display=extensive&page='+@queue($thread.counter,$wp,$ia,$sc)";

[dwscript]
$thread.url = $picture%url;
$thread.referer = $picture%post_url;

[fpgui]

$wp = 0;
$ia = 0;
$sc = 0;
$thread.result = 0;

^ul#id='tabs'{
	^a{
		$id = @urlvar("tid",#href);
		$idx = @urlvar("index",#href);
		^span{
			?$idx=1&$wallpapers='True'{
				$wp = @trim(@trim(@text,"("),")") / $picsperpage + 1;
				$thread.result = $thread.result + @trim(@trim(@text,"("),")");
			}
			?$idx=2&$indyart='True'{
				$ia = @trim(@trim(@text,"("),")") / $picsperpage + 1;
				$thread.result = $thread.result + @trim(@trim(@text,"("),")");
			}
			?$idx=3&$scans='True'{
				$sc = @trim(@trim(@text,"("),")") / $picsperpage + 1;
				$thread.result = $thread.result + @trim(@trim(@text,"("),")");
			}
		}
	}
}
$thread.count = $wp + $ia + $sc + 1;

[listgui]

^dl#class='wallpapers'{
	^{^dt{
		$post_url = '';
		$type = '';
		^a{
			^em{
				%type = 'elite';
			}
			^strong{
				%type = 'highlight';
			}
			^img{
				@addpicture(
					%url = @replace($gui_images_part,$gui_thumbs_part,#href),
					%preview = #href,
					%type = $type
				);
				$picture.filename = @emptyname($picture%url);
			}
		}
	}
	^dd{
		^h3{
			^a{
				%post_url = #href;
				%title = @text;
			}
		}
		^p!{
			^a{
				%category = @text;
			}
		}
		^p#class='description'{
			$fav = @copybacktoex(",",@text);
			?$fav!''{
				$sizes = @replace("",","+$fav,@text);
				%width = @copyto("x",@trim(@copybackto(",",$sizes)));
				%height = @copyfrom("x",@trim(@copybackto(",",$sizes)));
				%aspect_ratio = $picture%width/$picture%height;
				%score = @copyto(" ",@trim($fav));
				$sizes=@replace("",","+@copybackto(",",$sizes);
			}
			^a{
				@addtag(@text));
			}
		}
		?$allsizes='True'{
			@clonepic($sizes!'',$sizes=@deletetoex(",",$sizes),
			%url = picture%url+"-"+@trim(@copyto(",",$sizes)),
			%width = @copyto("x",@trim(@copyto(",",$sizes))),
			%height = @copyfrom("x",@trim(@copyto(",",$sizes))),
			%aspect_ratio = $picture%width/$picture%height);
		}
	}}
}